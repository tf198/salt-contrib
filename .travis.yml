language: python

python:
  #- '2.6'
  - '2.7'

before_install:
  - sudo apt-get update
  - sudo apt-get install --fix-broken --ignore-missing -y -o Dpkg::Options::="--force-confdef" -o Dpkg::Options::="--force-confold" swig
  #- (git describe && git fetch --tags) || (git remote add upstream git://github.com/saltstack/salt.git && git fetch --tags upstream)
  - pip install http://dl.dropbox.com/u/174789/m2crypto-0.20.1.tar.gz
  - "if [[ $TRAVIS_PYTHON_VERSION == '2.6' ]]; then pip install --use-mirrors --mirrors=http://testpypi.python.org/pypi unittest2 ordereddict; fi"
  - pip install mock --use-mirrors --mirrors=http://testpypi.python.org/pypi

install:
  - pip install -r requirements.txt --use-mirrors
  - git clone git://github.com/saltstack/salt.git ~/salt
  - git --git-dir=/home/travis/salt/.git describe && git --git-dir=/home/travis/salt/.git fetch --tags
  - pip install -e ~/salt
  - /home/travis/virtualenv/python${TRAVIS_PYTHON_VERSION}/bin/python patch_dev.py ~/salt
script: "/home/travis/virtualenv/python${TRAVIS_PYTHON_VERSION}/bin/python ~/salt/setup.py test --runtests-opts='-n contrib.tests -v'"
